<!DOCTYPE html>
<html>
<head>
    <title>PeerCode Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.4/peerjs.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/ruby/ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/markdown/markdown.min.js"></script>
    <style>
        :root {
            --accent: #00ff9d;
            --accent-gradient: linear-gradient(to right, #00ff9d, #00a6ff);
            --bg-dark: #0a0a0a;
            --bg-glass: rgba(255, 255, 255, 0.03);
        }
        
        [data-theme="purple"] {
            --accent: #bd00ff;
            --accent-gradient: linear-gradient(to right, #bd00ff, #4c00ff);
        }
        body {
            background: radial-gradient(circle at 50% -50%, #1a1a1a, var(--bg-dark));
            font-family: 'JetBrains Mono', monospace;
        }
        .glass {
            background: rgba(20, 20, 20, 0.7);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .glass-hover:hover {
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.1);
        }
        .accent-glow {
            text-shadow: 0 0 10px var(--accent);
        }
        .CodeMirror {
            height: calc(100vh - 4rem);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            background: transparent !important;
            color: #fff;
        }
        .CodeMirror-gutters {
            background: rgba(0, 0, 0, 2) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        .CodeMirror-linenumber { color: rgba(255, 255, 255, 0.3); }
        .peer-cursor {
            border-left: 2px solid var(--cursor-color) !important;
            height: 1.2em !important;
            margin-top: -0.4em;
            box-shadow: 0 0 12px var(--cursor-glow),
                       0 0 20px var(--cursor-glow),
                       0 0 5px #fff,
                       0 0 2px #000 !important;
            position: relative;
            z-index: 100;
            background: linear-gradient(90deg, 
                        rgba(255, 255, 255, 0.5) 0%, 
                        var(--cursor-bg) 20%,
                        transparent 100%);
            width: 2px !important;
            display: inline-block;
            pointer-events: none;
            animation: cursorPulse 1.5s ease-in-out infinite;
        }

        @keyframes cursorPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.2); }
        .animate-pulse-slow { animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes slide-in {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .slide-in { animation: slide-in 0.3s ease-out; }
        .cm-s-monokai.CodeMirror { 
            background: rgba(20, 20, 20, 0.7) !important; 
        }
        .cm-s-monokai .CodeMirror-gutters {
            background: rgba(0, 0, 0, 0.3) !important;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        input:focus {
            outline: none;
            border-color: var(--accent);
        }
    </style>
</head>
<body class="text-gray-300 h-screen flex overflow-hidden">
    <div class="w-72 glass border-r border-gray-800 flex flex-col slide-in">
        <div class="p-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-[var(--accent)] to-[#00a6ff] flex items-center justify-center">
                    <i class="fas fa-code text-black text-lg"></i>
                </div>
                <span class="text-lg font-semibold text-white accent-glow">PeerCode</span>
            </div>
            <button id="theme-toggle" class="p-2 rounded hover:bg-white/5 transition-colors">
                <i class="fas fa-palette"></i>
            </button>
        </div>
        <div class="p-4 flex items-center justify-between">
            <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Files</h2>
            <div class="flex items-center space-x-2">
                <div id="save-indicator" class="text-xs text-gray-400"></div>
                <button onclick="createNewFile()" class="p-2 rounded hover:bg-white/5 transition-colors">
                    <i class="fas fa-plus text-[var(--accent)]"></i>
                </button>
            </div>
        </div>
        <div class="px-4 mb-2">
            <div class="relative">
                <input type="text" 
                       id="file-search" 
                       class="w-full bg-black/20 border border-gray-800 rounded-md px-4 py-2 text-sm text-white focus:border-[var(--accent)] transition-colors outline-none"
                       placeholder="Search files...">
                <i class="fas fa-search absolute right-3 top-3 text-gray-400 text-xs"></i>
            </div>
        </div>
        <div class="flex-1 overflow-y-auto">
            <ul id="file-list" class="py-2"></ul>
        </div>
    </div>
    <div class="flex-1 flex flex-col">
        <div class="h-16 glass flex items-center px-6 justify-between">
            <div class="flex items-center space-x-4">
                <div id="connection-status" class="text-sm rounded-md px-3 py-1.5 glass"></div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="glass px-4 py-1.5 rounded-md flex items-center space-x-3">
                    <span class="text-xs text-gray-400">YOUR ID</span>
                    <input type="text" id="peer-id" class="bg-transparent w-32 text-sm" readonly>
                </div>
                <div class="glass px-4 py-1.5 rounded-md flex items-center space-x-3">
                    <span class="text-xs text-gray-400">CONNECT TO</span>
                    <input type="text" id="connect-to" class="bg-transparent w-32 text-sm" placeholder="Peer ID">
                </div>
                <div class="glass px-4 py-1.5 rounded-md flex items-center space-x-3">
                    <label for="cursorColor" class="text-xs text-gray-400">COLOR</label>
                    <input type="color" id="cursorColor" class="bg-transparent w-8 h-8 p-0 border-0 outline-none cursor-pointer" value="#00ff9d">
                </div>
                <button onclick="connectToPeer()" class="px-4 py-1.5 rounded-md bg-gradient-to-r from-[var(--accent)] to-[#4c00ff] text-black font-medium text-sm hover:shadow-lg hover:shadow-[var(--accent)]/20 transition-all">
                    <i class="fas fa-link mr-2"></i>Connect
                </button>
            </div>
        </div>
        <div class="flex-1 overflow-hidden p-4">
            <div class="h-full glass rounded-lg overflow-hidden">
                <textarea id="editor"></textarea>
            </div>
        </div>
    </div>
    <div id="new-file-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="glass rounded-xl w-[400px] p-6 shadow-2xl shadow-black/20 scale-100 opacity-100 transition-all duration-200">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-white">Create New File</h3>
                <button onclick="closeNewFileModal()" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="new-file-form" onsubmit="handleNewFile(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">File Name</label>
                    <div class="relative">
                        <input type="text" 
                               id="new-file-name" 
                               class="w-full bg-black/20 border border-gray-800 rounded-md px-4 py-2 text-white focus:border-[var(--accent)] transition-colors outline-none"
                               placeholder="example.js">
                        <div class="absolute right-3 top-2.5 text-gray-500 text-sm"></div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">File Type</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button type="button" onclick="setFileType('js')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fab fa-js text-yellow-500 mr-2"></i>JS
                        </button>
                        <button type="button" onclick="setFileType('html')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fab fa-html5 text-orange-500 mr-2"></i>HTML
                        </button>
                        <button type="button" onclick="setFileType('css')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fab fa-css3 text-blue-500 mr-2"></i>CSS
                        </button>
                        <button type="button" onclick="setFileType('txt')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fas fa-file-alt text-gray-400 mr-2"></i>TXT
                        </button>
                    </div>
                    <div class="grid grid-cols-4 gap-2 mt-2">
                        <button type="button" onclick="setFileType('py')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fab fa-python text-blue-400 mr-2"></i>PY
                        </button>
                        <button type="button" onclick="setFileType('rb')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fas fa-gem text-red-400 mr-2"></i>RB
                        </button>
                        <button type="button" onclick="setFileType('php')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fab fa-php text-purple-400 mr-2"></i>PHP
                        </button>
                        <button type="button" onclick="setFileType('md')" class="file-type-btn px-3 py-2 rounded-md text-sm glass-hover transition-all">
                            <i class="fab fa-markdown text-white mr-2"></i>MD
                        </button>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" 
                            onclick="closeNewFileModal()" 
                            class="px-4 py-2 rounded-md text-sm text-gray-400 hover:text-white transition-colors">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 rounded-md bg-gradient-to-r from-[var(--accent)] to-[#4c00ff] text-black font-medium text-sm hover:shadow-lg hover:shadow-[var(--accent)]/20 transition-all">
                        Create File
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>